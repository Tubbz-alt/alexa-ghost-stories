let languageStrings = {
    'en': {
        'translation': {
            'WELCOME' : 'Welcome to Ghost Stories!',
            'HELP'    : 'Say about, to hear more about submitting a story to the skill. Say updates, to hear about the latest addition. Or say, tell me a ghost story, when you are ready to be frightening.',
            'ABOUT'   : 'Ghost stories is a crowd-sourced skill. If you would like to submit a story to the skill, please visit the skill\'s webpage, or the skill\'s page in the Amazon store for more information.',
            'STOP'    : 'Okay, scare you later!',
			'UPDATES' : '<say-as interpret-as="date">10102017</say-as>, the skill was launched with 9 frightening ghost stories.'
        }
    }
};
let data = {
    'stories' : [
        {
			'title'			: 'Axe Murder Hollow',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
			'story'			: 'Susan and Ned were driving through a wooded empty section of highway. Lightning flashed, thunder roared, the sky went dark in the torrential downpour. "We\'d better stop," said Susan. Ned nodded his head in agreement. He stepped on the brake, and suddenly the car started to slide on the slick pavement. They plunged off the road and slid to a halt at the bottom of an incline. Pale and shaking, Ned quickly turned to check if Susan was all right. When she nodded, Ned relaxed and looked through the rain soaked windows. "I\'m going to see how bad it is," he told Susan, and when out into the storm. She saw his blurry figure in the headlight, walking around the front of the car. A moment later, he jumped in beside her, soaking wet. "The car\'s not badly damaged, but we’re wheel-deep in mud," he said. "I\'m going to have to go for help." Susan swallowed nervously. There would be no quick rescue here. He told her to turn off the headlights and lock the doors until he returned. Axe Murder Hollow. Although Ned hadn’t said the name aloud, they both knew what he had been thinking when he told her to lock the car. This was the place where a man had once taken an axe and hacked his wife to death in a jealous rage over an alleged affair. Supposedly, the axe-wielding spirit of the husband continued to haunt this section of the road. Outside the car, Susan heard a shriek, a loud thump, and a strange gurgling noise. But she couldn’t see anything in the darkness. Frightened, she shrank down into her seat. She sat in silence for a while, and then she noticed another sound. <break time="1s"/>Bump. <break time="1s"/>Bump. <break time="1s"/>Bump. It was a soft sound, like something being blown by the wind. Suddenly, the car was illuminated by a bright light. An official sounding voice told her to get out of the car. Ned must have found a police officer. Susan unlocked the door and stepped out of the car. As her eyes adjusted to the bright light, she saw it. Hanging by his feet from the tree next to the car was the dead body of Ned. His bloody throat had been cut so deeply that he was nearly decapitated. The wind swung his corpse back and forth so that it thumped against the tree. <break time="1s"/>Bump. <break time="1s"/>Bump. <break time="1s"/>Bump. Susan screamed and ran toward the voice and the light. As she drew close, she realized the light was not coming from a flashlight. Standing there was the glowing figure of a man with a smile on his face and a large, solid, and definitely real axe in his hands. She backed away from the glowing figure until she bumped into the car. "Playing around when my back was turned," the ghost whispered, stroking the sharp blade of the axe with his fingers. "You’ve been very naughty." The last thing she saw was the glint of the axe blade in the eerie, incandescent light.',
		},
		{
			'title'			: 'Bear Lake Monster',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: 'If you travel to Bear Lake in Utah on a quiet day, you just might catch a glimpse of the Bear Lake Monster. The monster looks like a huge brown snake and is nearly 90 feet long. It has ears that stick out from the side of its skinny head and a mouth big enough to eat a man. According to some, it has small legs and it kind of scurries when it ventures out on land. But in the water - watch out! It can swim faster than a horse can gallop - makes a mile a minute on a good day. Sometimes the monster likes to sneak up on unwary swimmers and blow water at them. The ones it doesn\'t carry off to eat, that is. A fella I heard about spotted the monster early one evening as he was walking along the lake. He tried to shoot it with his rifle. The man was a crack shot, but not one of his bullets touched that monster. It scared the heck out of him and he high tailed it home faster than you can say Jackie Robinson. Left his rifle behind him and claimed the monster ate it. Sometimes, when the monster has been quiet for a while, people start saying it is gone for good. Some folks even dredge up that old tale that says how Pecos Bill heard about the Bear Lake monster and bet some cowpokes that he could wrestle that monster until it said uncle. According to them folks, the fight lasted for days and created a hurricane around Bear Lake. Finally, Bill flung that there monster over his shoulder and it flew so far it went plumb around the world and landed in Loch Ness, where it lives to this day. Course, we know better than that. The Bear Lake Monster is just hibernating-like. Keep your eyes open at dusk and maybe you\'ll see it come out to feed. Just be careful swimming in the lake, or you might be its next meal!',
		},
		{
			'title'			: 'Big Liz',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: 'The Master of the plantation was a firm supporter of the Confederate President and had committed to send as much food as he could to the Southern army. Things were going well at first, until the Yankees began attacking the Master\'s supply lines. The Master suspected a traitor among his slaves, and soon discovered that the Yankee spy was a slave-woman named Big Liz. She was a behemoth of a girl who could pick up two full-grown pigs, one under each arm, and cart them over to the slaughterhouse without assistance. If he confronted her directly and she fought back, she would take him to pieces. So the Master came up with a different plan to rid himself of the spy. He approached the giant girl and asked her to assist him with a special task. He told her that President Jefferson Davis had entrusted him with a large chest full of gold. To keep it out of Yankee hands, he wanted to bury the chest where it would never be found. The girl\'s eyes gleamed when she heard this false report. The Master knew she was already planning to betray the existence of the chest to the Yankees. The Master made Big Liz carry the heavy trunk several miles out into the swamp land and asked her to dig a deep hole for the trunk. He sat at his leisure while she worked and strained for hours against the muddy ground, which kept oozing back into the hole. When the slave girl was completely exhausted, the Master decreed the hole to be large enough for his war chest. Wearily, Big Liz dropped the shovel and pulled the heavy chest down until it lay at her feet. Then she started to climb out of the deep hole. But the Master barred her way, and Big Liz gazed up at him in sudden fear as he loomed over her. "Traitor! Yankee spy!" The Master hissed. "There is only one path open to a traitor." The Master swung his sword at her, and the sharp edge of the blade cut cleaning through the slave girl\'s neck. Her head went rolling away into the tall grass as her body toppled across the chest. The Master heaped dirt over the chest and the body of slave girl who had betrayed him. Briefly, he considered finding her head and burying it in the pit with her body, but it was too dark to go wandering in the dangerous marshland, and he knew that scavengers would make short work of the head when they found it. As the Master walked toward home through the dark swamp, he became aware of a prickling sensation at the back of his neck, as if someone were watching him. The Master walked faster as clouds obscured the light of the moon. The Master\'s teeth chattered as a breeze cut through him like the sharpened blade of the sword at his side, and his straining ears picked up the sound of footsteps on the path behind him. The Master was filled with a terrible, superstitious dread of demons and witches and ghosts. He broke out into a panicked run, fleeing up the path as fast as his legs would carry him. To his relief, he saw the lights of his house rise before him, and knew he was home. As he rounded the back corner of his house, he was confronted by a massive, dirt-encrusted figure that glowed with blue fire. The smell of rotting leaves and marsh grass filled his nostrils as his eyes raced up and up the tall creature, until they rested on the stump of its neck, where a head had resided only an hour before. Then he heard a chuckle from the creature\'s side, and he saw the phantom\'s head tucked under her arm. The Master stumbled backward, gabbling desperately in fear as the ghost placed her head upon the ground with one hand and grabbed the collar of his shirt with the other. The murdered slave girl snapped the Master\'s neck in two and dropped his dead body to the ground beneath his bedroom window. Then Big Liz gathered up her severed head and vanished into the darkness. They say that on the anniversary of her death, the ghost of Big Liz still may be seen roaming the swamp lands near her old home. Anyone foolish enough to walk near her grave will be driven away by the phantom, which to this day still defends the place where the Confederate chest is buried.',
		},
		{
			'title'			: 'Bloody Mary',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: 'She lived deep in the forest in a tiny cottage and sold herbal remedies for a living. Folks living in the town nearby called her Bloody Mary, and said she was a witch. None dared cross the old crone for fear that their cows would go dry, their food-stores rot away before winter, their children take sick of fever, or any number of terrible things that an angry witch could do to her neighbors. Then the little girls in the village began to disappear, one by one. No one could find out where they had gone. Grief-stricken families searched the woods, the local buildings, and all the houses and barns, but there was no sign of the missing girls. A few brave souls even went to Bloody Mary\'s home in the woods to see if the witch had taken the girls, but she denied any knowledge of the disappearances. Still, it was noted that her haggard appearance had changed. She looked younger, more attractive. The neighbors were suspicious, but they could find no proof that the witch had taken their young ones. Then came the night when the daughter of the miller rose from her bed and walked outside, following an enchanted sound no one else could hear. The miller\'s wife had a toothache and was sitting up in the kitchen treating the tooth with an herbal remedy when her daughter left the house. She screamed for her husband and followed the girl out of the door. The miller came running in his nightshirt. Together, they tried to restrain the girl, but she kept breaking away from them and heading out of town. The desperate cries of the miller and his wife woke the neighbors. They came to assist the frantic couple. Suddenly, a sharp-eyed farmer gave a shout and pointed towards a strange light at the edge of the woods. A few townsmen followed him out into the field and saw Bloody Mary standing beside a large oak tree, holding a magic wand that was pointed towards the miller\'s house. She was glowing with an unearthly light as she set her evil spell upon the miller\'s daughter. The townsmen grabbed their guns and their pitchforks and ran toward the witch. When she heard the commotion, Bloody Mary broke off her spell and fled back into the woods. The far-sighted farmer had loaded his gun with silver bullets in case the witch ever came after his daughter. Now he took aim and shot at her. The bullet hit Bloody Mary in the hip and she fell to the ground. The angry townsmen leapt upon her and carried her back into the field, where they built a huge bonfire and burned her at the stake. As she burned, Bloody Mary screamed a curse at the villagers. If anyone mentioned her name aloud before a mirror, she would send her spirit to revenge herself upon them for her terrible death. When she was dead, the villagers went to the house in the wood and found the unmarked graves of the little girls the evil witch had murdered. She had used their blood to make her young again. From that day to this, anyone foolish enough to chant Bloody Mary\'s name three times before a darkened mirror will summon the vengeful spirit of the witch. It is said that she will tear their bodies to pieces and rip their souls from their mutilated bodies. The souls of these unfortunate ones will burn in torment as Bloody Mary once was burned, and they will be trapped forever in the mirror.',
		},
		{
			'title'			: 'Don\'t Sell My House',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: 'Life seemed perfect to Mark when the widower brought his new bride Lisa home to the lovely two-story cottage he had build for his deceased first wife. Things were very happy for about a year, and Mark was ecstatic when he learned Lisa was expecting twins. The house was rather small for a double addition to the family, so Mark and Lisa put the cottage up for sale and started searching for a bigger house. That\'s when the problems began. Suddenly, the cottage would be filled with the distinctive smell of expensive perfume. The first time Mark smelled it, he turned pale and told Lisa that it was the scent his dead wife had favored. Then furniture that Lisa had rearranged moved back to its original place. The books in Mark\'s study were taken out of their categories and put in alphabetical order, the way his former wife had kept them. The ghost of Mark\'s first wife had returned to the little cottage. But why now, a full year after he had remarried? One afternoon, Lisa was down in the basement doing laundry while Mark was out front discussing the sale of the cottage with their attorney. They had just received a generous bid on the house and had decided to accept it. When Lisa finished emptying the washing machine, she turned to go back upstairs and saw a young woman floating a foot above the staircase. "This is my house. Don\'t sell my house!" the woman said. Her pretty face transformed with rage. She shook her fist at Lisa. Lisa shrieked, dropped the basket of wet laundry, and ran outside. Slamming the basement door behind her, Lisa locked it and sat down on the lawn, gasping for breath. All at once, the basement door started shaking violently, as if someone were pushing against it. "Don\'t sell my house," the phantom exclaimed again, shaking the door. "If you sell my house, something terrible will happen to your family! Don\'t sell my house!" The roar of a car engine pierced the ghost\'s words, as the attorney  bade Mark goodbye and drove away. Immediately, the shaking and pounding ceased, as if the departure of the hated real-estate attorney had momentarily appeased the ghost. When Lisa described the ghost, Mark recognized her as his dead wife. Until then, he had forgotten that he promised his first wife that he would never sell the cottage. Mark and Lisa tried to appease the ghost by bringing in a priest to pray over the cottage.  But the house continued to be filled with the choking smell of expensive perfume. Lisa was afraid for her unborn babies, living in such a haunted atmosphere. After much discussion, Mark and Lisa decided to defy the phantom and sell the cottage. On the night following the family\'s move, Lisa was struck with a terrible pain in her abdomen. Mark rushed her to the hospital, where she gave birth to the twins, who were stillborn. On his way home from the hospital, Mark\'s car was struck by a truck, and he was killed instantly. At the same moment, Lisa sat bolt upright in her hospital bed, staring at an empty corner of the room. She screamed once in terror at the sight of the phantom floating before her eyes, then she died instantly from a brain aneurism.',
		},
		{
			'title'			: '',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: '',
		},
		{
			'title'			: '',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: '',
		},
		{
			'title'			: '',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: '',
		},
		{
			'title'			: '',
			'author'		: 'S.E. Schlosser',
			'contributor'	: 'morsecodemedia',
            'story'			: '',
		}
    ]
}

let Alexa = require('alexa-sdk');

exports.handler = function(event, context, callback) {
    var alexa = Alexa.handler(event, context);
    alexa.resources = languageStrings;
    alexa.registerHandlers(handlers);
    alexa.execute();
};

let handlers = {
    'LaunchRequest': function () {
        var say = this.t('WELCOME') + ' ' + this.t('HELP');
        this.emit(':ask', say, say);
    },
    'AboutIntent': function () {
        this.emit(':tell', this.t('ABOUT'));
    },
	'UpdatesIntent': function() {
		this.emit(':tell', this.t('UPDATES'));
	},
    'AMAZON.HelpIntent': function () {
        this.emit(':ask', this.t('HELP'));
    },
    'AMAZON.CancelIntent': function () {
        this.emit(':tell', this.t('STOP'));
    },
    'AMAZON.StopIntent': function () {
        this.emit(':tell', this.t('STOP'));
    },
	'AMAZON.NoIntent': function () {
        this.emit('AMAZON.StopIntent');
    },
	'AMAZON.YesIntent': function () {
        let storyTitle = this.attributes['story'];
        let storyDetails = getStoryBytitle(storyTitle);

        let say = storyDetails.title
            + ' by ' + storyDetails.author
            + ', was contributed by ' + storyDetails.contributor
            + ', ' + storyDetails.story;

        let card = storyDetails.title + '\n author: ' + storyDetails.author + '\n contributed by: '
            + storyDetails.contributor + '\n';

        this.emit(':tellWithCard', say, storyDetails.title, card);

    },
    'StoryIntent': function () {
        let story = randomArrayElement(getStoryByTitle());
        this.attributes['story'] = story.title;

        let say = 'Ah, here's a good one, ' + story.title + '. Would you like to hear it?';
        this.emit(':ask', say);
    }
};

function getStoryByTitle() {
    let list = [];
    for (var i = 0; i < data.stories.length; i++) {
        if(data.stories[i].title >  -1) {
            list.push(data.stories[i]);
        }
    }
    return list;
}

function randomArrayElement(array) {
    var i = 0;
    i = Math.floor(Math.random() * array.length);
    return(array[i]);
}